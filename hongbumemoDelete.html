<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>hongbuMemo DB ì¡´ì¬ ì—¬ë¶€ í™•ì¸</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      margin: 20px;
    }
    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid #444;
      background: #111;
      color: #fff;
      font-weight: 700;
    }
    pre {
      margin-top: 16px;
      padding: 14px;
      border-radius: 12px;
      background: #0b0b0b;
      color: #e5e5e5;
      border: 1px solid #333;
      white-space: pre-wrap;
    }
    .ok { color: #7CFF7C; }
    .warn { color: #FFB020; }
    .err { color: #FF6B6B; }
  </style>
</head>
<body>

<h2>hongbuMemo IndexedDB ì¡´ì¬ ì—¬ë¶€ í™•ì¸</h2>

<button id="btnCheck">ğŸ” hongbuMemo ê²€ì‚¬</button>

<pre id="result">(ê²€ì‚¬ ì „)</pre>

<script>
(() => {
  const DB_NAME = "hongbuMemo";
  const $out = document.getElementById("result");
  const $btn = document.getElementById("btnCheck");

  function log(msg, cls="") {
    $out.innerHTML += (cls ? `<span class="${cls}">${msg}</span>` : msg) + "\n";
    console.log(msg);
  }

  async function checkHongbuMemo() {
    $out.textContent = "";
    log(`â–¶ ê²€ì‚¬ ì‹œì‘: ${DB_NAME}\n`);

    // iOSì—ì„œëŠ” indexedDB.databases() ê±°ì˜ ë¯¸ì§€ì›
    if (typeof indexedDB.databases === "function") {
      try {
        const dbs = await indexedDB.databases();
        const found = dbs.find(d => d.name === DB_NAME);
        if (found) {
          log(`âœ… indexedDB.databases(): ${DB_NAME} ë°œê²¬ (ver=${found.version})`, "ok");
        } else {
          log(`â„¹ï¸ indexedDB.databases(): ${DB_NAME} ì—†ìŒ`, "warn");
        }
      } catch (e) {
        log(`â„¹ï¸ indexedDB.databases() ì‹¤íŒ¨ (iOSì¼ ê°€ëŠ¥ì„±)`, "warn");
      }
    } else {
      log(`â„¹ï¸ indexedDB.databases() ë¯¸ì§€ì› (iOS WebKit)`, "warn");
    }

    // ğŸ”‘ iOSì—ì„œ ê°€ì¥ ì‹ ë¢° ê°€ëŠ¥í•œ ë°©ë²•: open + onupgradeneeded ì—¬ë¶€
    await new Promise(resolve => {
      const req = indexedDB.open(DB_NAME);
      let existed = true;

      req.onupgradeneeded = () => {
        existed = false;
        log(`âŒ ${DB_NAME} ì—†ìŒ â†’ onupgradeneeded ë°œìƒ(ìƒˆ DB ìƒì„± ì‹œë„)`, "err");
        try { req.transaction.abort(); } catch {}
      };

      req.onsuccess = () => {
        const db = req.result;
        if (existed) {
          log(`âœ… ${DB_NAME} ì¡´ì¬í•¨`, "ok");
          log(`   - version: ${db.version}`);
          log(`   - objectStores: [${Array.from(db.objectStoreNames).join(", ") || "(ì—†ìŒ)"}]`);
        } else {
          log(`âŒ ${DB_NAME} ì‹¤ì œë¡œëŠ” ì—†ìŒ(ìƒì„± ì‹œë„ë§Œ ë¨)`, "err");
        }
        db.close();
        resolve();
      };

      req.onerror = () => {
        log(`âŒ open ì‹¤íŒ¨: ${req.error?.message || req.error}`, "err");
        resolve();
      };
    });

    log(`\nâ–¶ ê²€ì‚¬ ì™„ë£Œ`);
  }

  $btn.addEventListener("click", checkHongbuMemo);
})();
</script>

</body>
</html>
