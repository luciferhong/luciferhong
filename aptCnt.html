<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>[ë£¨ì‹œí¼í™] ì„ì¥ì§€ ë‹¨ì§€ ëª‡ ê°œì§€?</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
  :root{
    --bg:#fefefe; --card:#ffffff; --muted:#6c6c6c; --text:#222222;
    --border:rgba(0,0,0,.08); --pane-h:72vh; --right-pager-h:46px;
  }
  html,body{height:100%}
  body{
    margin:0; background:#fff; color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    overflow:hidden;
  }
  .wrap{display:grid;grid-template-rows:auto 1fr;min-height:100vh;gap:14px;padding:16px;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;}
  header h1{margin:0;font-size:22px;font-weight:700;}
  header .meta{font-size:12px;color:var(--muted)}
  .panes{display:grid;grid-template-columns:320px 1fr;gap:14px;min-height:0;height:calc(100vh - 96px);}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 4px 10px rgba(0,0,0,.05);min-height:0;display:flex;flex-direction:column;overflow:hidden;}
  .card header{padding:10px 14px;border-bottom:1px solid var(--border)}
  .card header h2{margin:0;font-size:15px}
  .card .body{padding:10px;min-height:0;display:flex;flex-direction:column;gap:8px;height:100%;}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  input[type="text"],input[type="number"],select{background:#fff;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px 10px;outline:none;}
  label.ck{display:flex;gap:6px;align-items:center;font-size:13px;color:#333;}
  .pill{border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted);}
  .legend{font-size:12px;color:var(--muted)}
  .table-wrap{border:1px solid var(--border);border-radius:10px;overflow:auto;background:#fff;}
  table{border-collapse:separate;border-spacing:0;width:100%;font-size:13px;}
  thead th{position:sticky;top:0;background:#f2f4f7;color:#333;z-index:1;text-align:left;padding:8px 10px;border-bottom:1px solid var(--border);white-space:nowrap;}
  tbody td{padding:8px 10px;border-bottom:1px solid rgba(0,0,0,.05);}
  tbody tr:hover{background:rgba(0,0,0,.03);}
  .left-wrap{height:var(--pane-h)}
  .left-wrap thead th:nth-child(1){width:38%}
  .left-wrap thead th:nth-child(2){width:42%}
  .left-wrap thead th:nth-child(3){width:20%;text-align:right;}
  .left-wrap td:last-child{text-align:right;}
  .right-wrap{height:calc(var(--pane-h) - var(--right-pager-h))}
  #pager{display:flex;gap:8px;align-items:center;margin:4px 0 0 0;padding:0;height:var(--right-pager-h)}
  .download-btn{
    background:#e7f1ff;color:#0055cc;border:1px solid rgba(0,85,204,.3);
    border-radius:8px;padding:6px 10px;font-size:12px;cursor:pointer;transition:.2s;
  }
  .download-btn:hover{background:#d0e4ff;}
  .unit-btn{
    margin-left:6px;background:#e7f1ff;color:#0055cc;border:1px solid rgba(0,85,204,.3);
    border-radius:8px;padding:6px 10px;font-size:12px;cursor:pointer;transition:.2s;
  }
  .unit-btn:hover{background:#d0e4ff;}

  /* ğŸ§¡ ì‚´êµ¬ìƒ‰ í—¤ë” (ë‘ ì¹´ë“œ í—¤ë”ë§Œ) */
  #leftCard > header,
  .card:not(#leftCard) > header {
    background: linear-gradient(90deg, #ffe0b2 0%, #fff3e0 100%);
    color: #7a3e00;
    font-weight: 600;
    border-bottom: 1px solid rgba(255,160,60,.3);
    box-shadow: inset 0 -2px 4px rgba(255,160,60,.1);
  }
  #leftCard > header h2,
  .card:not(#leftCard) > header h2 { color:#7a3e00; }

  @media (max-width:1024px){
    html,body{height:auto;} body{overflow:auto;}
    .panes{grid-template-columns:1fr;grid-template-rows:auto auto;height:auto;}
    #leftCard{max-height:calc(100dvh - 120px)!important;overflow:hidden;}
    #leftCard .body{display:flex;flex-direction:column;height:100%;min-height:0;}
    #leftCard .left-wrap{flex:1 1 auto;min-height:0;overflow:auto;overscroll-behavior:contain;}
    .right-wrap{margin-top:12px;height:auto;max-height:none;}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>[ë£¨ì‹œí¼í™] ì„ì¥ì§€ ë‹¨ì§€ ëª‡ ê°œì§€?</h1>
      
    </div>
    <div class="toolbar"><span class="pill" id="summaryMeta">ë°ì´í„° ë¡œë”©ì¤‘â€¦</span></div>
  </header>

  <div class="panes">
    <!-- LEFT -->
    <section class="card" id="leftCard">
      <header><h2>ì‹œêµ°êµ¬ë³„ ë‹¨ì§€ìˆ˜</h2></header>
      <div class="body">
        <div class="toolbar">
          <input id="leftSearch" type="text" placeholder="ê²€ìƒ‰: ì‹œë„ëª…/ì‹œêµ°êµ¬" />
        </div>
        <div class="toolbar">
          <label class="ck"><input type="checkbox" id="ckSale" />ì•„íŒŒíŠ¸ë¶„ì–‘ê¶Œ í¬í•¨</label>
          <label class="ck">ì„¸ëŒ€ìˆ˜(ì´ìƒ)
            <input id="minUnits" type="number" min="0" step="10" value="200" style="width:60px;text-align:right;" />
            <button type="button" class="unit-btn" data-val="200">200</button>
            <button type="button" class="unit-btn" data-val="300">300</button>
          </label>
        </div>
        <div class="toolbar">
          <label class="ck">ì „ìš©ë©´ì 
            <input id="areaFrom" type="number" min="0" step="1" placeholder="from" style="width:70px" /> ~
            <input id="areaTo" type="number" min="0" step="1" placeholder="to" style="width:70px" /> ã¡
          </label>
        </div>
        
        <div class="table-wrap left-wrap">
          <table id="leftTable">
            <thead>
              <tr>
                <th>ì‹œë„ëª…</th>
                <th>ì‹œêµ°êµ¬</th>
                <th id="sortByCount" style="cursor:pointer;">ë‹¨ì§€ìˆ˜</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- RIGHT -->
    <section class="card">
      <header><h2>ìƒì„¸ ë°ì´í„°</h2></header>
      <div class="body">
        <div class="toolbar">
          <input id="detailSearch" type="text" placeholder="ììœ  ê²€ìƒ‰ (ëª¨ë“  ì»¬ëŸ¼ ë˜ëŠ” ì„ íƒ ì»¬ëŸ¼)" />
          <select id="colSelect">
            <option value="">ëª¨ë“  ì»¬ëŸ¼ì—ì„œ ê²€ìƒ‰</option>
            <option>ì‹œë„ëª…</option><option>ì‹œêµ°êµ¬</option><option>ìë©´ë™</option><option>ìœ í˜•</option>
            <option>ë‹¨ì§€ì½”ë“œ</option><option>ë‹¨ì§€ëª…</option><option>ì‚¬ìš©ìŠ¹ì¸ì¼</option><option>ì´ì„¸ëŒ€ìˆ˜</option><option>ì „ìš©ë©´ì </option>
          </select>
          <span id="filterBadge" class="pill" style="display:none;"></span>
        </div>

        <div class="table-wrap right-wrap">
          <table id="detailTable">
            <thead><tr>
              <th>ì‹œë„ëª…</th><th>ì‹œêµ°êµ¬</th><th>ìë©´ë™</th><th>ìœ í˜•</th>
              <th>ë‹¨ì§€ì½”ë“œ</th><th>ë‹¨ì§€ëª…</th><th>ì‚¬ìš©ìŠ¹ì¸ì¼</th><th>ì´ì„¸ëŒ€ìˆ˜</th><th>ì „ìš©ë©´ì </th>
			  <th>êµ¬ì¡°</th><th>ë°©</th><th>ìš•ì‹¤</th><th>í‰í˜•</th><th>í‰í˜•ë³„ì„¸ëŒ€ìˆ˜</th>
            </tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- pager -->
        <div id="pager">
          <button id="prevBtn">ì´ì „</button>
          <span id="pageInfo" class="pill">-</span>
          <button id="nextBtn">ë‹¤ìŒ</button>

          <!-- âœ… í•œ í˜ì´ì§€ í‘œì‹œ í–‰ ìˆ˜ ì„ íƒ -->
          <select id="pageSizeSel" title="í•œ í˜ì´ì§€ í–‰ ìˆ˜">
            <option value="50">50í–‰</option>
            <option value="100" selected>100í–‰</option>
            <option value="200">200í–‰</option>
            <option value="500">500í–‰</option>
            <option value="1000">1000í–‰</option>
          </select>

          <span style="flex:1"></span>
          <button id="downloadBtn" class="download-btn">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
  // DOM
  const leftTbody   = document.querySelector('#leftTable tbody');
  const detailTbody = document.querySelector('#detailTable tbody');
  const leftSearch  = document.getElementById('leftSearch');
  const detailSearch= document.getElementById('detailSearch');
  const colSelect   = document.getElementById('colSelect');
  const filterBadge = document.getElementById('filterBadge');
  const summaryMeta = document.getElementById('summaryMeta');
  const prevBtn     = document.getElementById('prevBtn');
  const nextBtn     = document.getElementById('nextBtn');
  const pageInfo    = document.getElementById('pageInfo');
  const pageSizeSel = document.getElementById('pageSizeSel');
  const ckSale      = document.getElementById('ckSale');
  const minUnitsInp = document.getElementById('minUnits');
  const areaFromInp = document.getElementById('areaFrom');
  const areaToInp   = document.getElementById('areaTo');
  const sortByCountTh = document.getElementById('sortByCount');
  const downloadBtn = document.getElementById('downloadBtn');

  // STATE
  let apartments = [];
  let complexes  = [];
  let sggCounts  = [];
  let filteredDetail = [];
  let currentPage = 1;
  let pageSize   = 100; // ê¸°ë³¸ê°’
  let selectedSido = "", selectedSgg = "";
  let sortDir = null;

  // Utils
  function fmt(n){ try{ return new Intl.NumberFormat('ko-KR').format(n ?? 0); }catch(e){ return n; } }
  function toNum(v){ if(v==null||v==='') return NaN; const n=Number(String(v).replace(/,/g,'')); return Number.isFinite(n)?n:NaN; }

  // Build complexes (dedupe by ë‹¨ì§€ì½”ë“œ)
  function buildComplexes(rows){
    const map=new Map();
    for(const r of rows){
      const code=r['ë‹¨ì§€ì½”ë“œ']; if(!code) continue;
      const units=toNum(r['ì´ì„¸ëŒ€ìˆ˜']), area=toNum(r['ì „ìš©ë©´ì ']);
      const type=String(r['ìœ í˜•']||'');
      if(!map.has(code)){
        map.set(code,{ë‹¨ì§€ì½”ë“œ:String(code),ì‹œë„ëª…:r['ì‹œë„ëª…']||'',ì‹œêµ°êµ¬:r['ì‹œêµ°êµ¬']||'',ì´ì„¸ëŒ€ìˆ˜:Number.isFinite(units)?units:NaN,ë©´ì ëª©ë¡:Number.isFinite(area)?[area]:[],ë¶„ì–‘ê¶Œ:type.includes('ì•„íŒŒíŠ¸ë¶„ì–‘ê¶Œ')});
      }else{
        const ex=map.get(code);
        if(Number.isFinite(units)) ex.ì´ì„¸ëŒ€ìˆ˜ = Number.isFinite(ex.ì´ì„¸ëŒ€ìˆ˜)?Math.max(ex.ì´ì„¸ëŒ€ìˆ˜,units):units;
        if(Number.isFinite(area)) ex.ë©´ì ëª©ë¡.push(area);
        if(type.includes('ì•„íŒŒíŠ¸ë¶„ì–‘ê¶Œ')) ex.ë¶„ì–‘ê¶Œ=true;
      }
    }
    complexes=[...map.values()];
  }

  function complexAreaOk(ex, hasMin, min, hasMax, max){
    if(!hasMin && !hasMax) return true;
    if(!ex.ë©´ì ëª©ë¡.length) return false;
    return ex.ë©´ì ëª©ë¡.some(a => (!hasMin || a>=min) && (!hasMax || a<=max));
  }

  function computeSggCounts(){
    const includeSale=ckSale.checked;
    const minU=toNum(minUnitsInp.value)||0;
    const minA=toNum(areaFromInp.value), maxA=toNum(areaToInp.value);
    const hasMin=Number.isFinite(minA), hasMax=Number.isFinite(maxA);

    const filtered=complexes.filter(c=>{
      if(!includeSale && c.ë¶„ì–‘ê¶Œ) return false;
      if(!Number.isFinite(c.ì´ì„¸ëŒ€ìˆ˜) || c.ì´ì„¸ëŒ€ìˆ˜<minU) return false;
      if(!complexAreaOk(c,hasMin,minA,hasMax,maxA)) return false;
      return true;
    });

    const map=new Map();
    for(const c of filtered){
      const key=(c.ì‹œë„ëª…||'')+'||'+(c.ì‹œêµ°êµ¬||'');
      map.set(key,(map.get(key)||0)+1);
    }
    sggCounts=[...map.entries()].map(([k,cnt])=>{const[sido,sgg]=k.split('||');return{ì‹œë„ëª…:sido,ì‹œêµ°êµ¬:sgg,ë‹¨ì§€ìˆ˜:cnt}});

    if(sortDir==='asc') sggCounts.sort((a,b)=>a.ë‹¨ì§€ìˆ˜-b.ë‹¨ì§€ìˆ˜);
    else if(sortDir==='desc') sggCounts.sort((a,b)=>b.ë‹¨ì§€ìˆ˜-a.ë‹¨ì§€ìˆ˜);
    else sggCounts.sort((a,b)=>a.ì‹œë„ëª….localeCompare(b.ì‹œë„ëª…)||a.ì‹œêµ°êµ¬.localeCompare(b.ì‹œêµ°êµ¬));

    const q=(leftSearch.value||'').trim().toLowerCase();
    if(q){
      sggCounts=sggCounts.filter(r =>
        String(r.ì‹œë„ëª…||'').toLowerCase().includes(q) ||
        String(r.ì‹œêµ°êµ¬||'').toLowerCase().includes(q)
      );
    }

    if(sortDir==='asc') sortByCountTh.textContent='ë‹¨ì§€ìˆ˜ â–²';
    else if(sortDir==='desc') sortByCountTh.textContent='ë‹¨ì§€ìˆ˜ â–¼';
    else sortByCountTh.textContent='ë‹¨ì§€ìˆ˜';
  }

  function renderLeft(){
    leftTbody.innerHTML='';
    for(const r of sggCounts){
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.ì‹œë„ëª…||''}</td><td>${r.ì‹œêµ°êµ¬||''}</td><td style="text-align:right">${fmt(r.ë‹¨ì§€ìˆ˜)}</td>`;
      tr.style.cursor='pointer';
      tr.onclick=()=>{selectedSido=r.ì‹œë„ëª…||''; selectedSgg=r.ì‹œêµ°êµ¬||''; applyDetailFilter();};
      leftTbody.appendChild(tr);
    }
  }

  function paginate(rows){
    const total=rows.length;
    const max=Math.max(1,Math.ceil(total / pageSize));
    if(currentPage>max) currentPage=max;
    const start=(currentPage-1)*pageSize;
    const page=rows.slice(start,start+pageSize);
    pageInfo.textContent=`${fmt(currentPage)} / ${fmt(max)} Â· ì´ ${fmt(total)} í–‰`;
    prevBtn.disabled=currentPage<=1;
    nextBtn.disabled=currentPage>=max;
    return page;
  }

  function renderDetail(rows){
    detailTbody.innerHTML='';
    for(const r of paginate(rows)){
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${r['ì‹œë„ëª…']||''}</td>
        <td>${r['ì‹œêµ°êµ¬']||''}</td>
        <td>${r['ìë©´ë™']||''}</td>
        <td>${r['ìœ í˜•']||''}</td>
        <td>${r['ë‹¨ì§€ì½”ë“œ']||''}</td>
        <td>${r['ë‹¨ì§€ëª…']||''}</td>
        <td>${r['ì‚¬ìš©ìŠ¹ì¸ì¼']||''}</td>
        <td style="text-align:right">${fmt(r['ì´ì„¸ëŒ€ìˆ˜'])}</td>
        <td style="text-align:right">${r['ì „ìš©ë©´ì ']||''}</td>
        <td>${r['êµ¬ì¡°']||''}</td>
        <td style="text-align:right">${r['ë°©ìˆ˜']||''}</td>
<td style="text-align:right">${r['ìš•ì‹¤ìˆ˜']||''}</td>
<td>${r['í‰í˜•ëª…']||''}</td>
<td style="text-align:right">${r['í‰í˜•ë³„ ì„¸ëŒ€ìˆ˜']||''}</td>


`;

			
      detailTbody.appendChild(tr);
    }
  }

  function applyDetailFilter(){
    const includeSale=ckSale.checked;
    const minU=toNum(minUnitsInp.value)||0;
    const minA=toNum(areaFromInp.value), maxA=toNum(areaToInp.value);
    const hasMin=Number.isFinite(minA), hasMax=Number.isFinite(maxA);

    const ok=new Set();
    for(const c of complexes){
      if(!includeSale && c.ë¶„ì–‘ê¶Œ) continue;
      if(!Number.isFinite(c.ì´ì„¸ëŒ€ìˆ˜) || c.ì´ì„¸ëŒ€ìˆ˜<minU) continue;
      if(!complexAreaOk(c,hasMin,minA,hasMax,maxA)) continue;
      if(selectedSido && (c.ì‹œë„ëª…||'')!==selectedSido) continue;
      if((selectedSgg??'')!=='' && (c.ì‹œêµ°êµ¬||'')!==selectedSgg) continue;
      ok.add(c.ë‹¨ì§€ì½”ë“œ);
    }

    filteredDetail=apartments.filter(r=>{
      const inC=ok.has(String(r['ë‹¨ì§€ì½”ë“œ']||'')); if(!inC) return false;
      const a=toNum(r['ì „ìš©ë©´ì ']);
      if(!hasMin && !hasMax) return true;
      if(!Number.isFinite(a)) return false;
      if(hasMin && a<minA) return false;
      if(hasMax && a>maxA) return false;
      return true;
    });

    currentPage=1; renderDetail(filteredDetail);
    const sido=selectedSido||'ì „êµ­'; const sgg=(selectedSgg??'')===''?'':` ${selectedSgg}`;
    filterBadge.textContent=`${sido}${sgg} Â· í–‰ ${fmt(filteredDetail.length)}ê°œ`;
    filterBadge.style.display='';
  }

  function doDetailSearch(){
    const q=(detailSearch.value||'').trim().toLowerCase();
    const field=colSelect.value;
    const target=filteredDetail.length?filteredDetail:apartments;
    if(!q){ currentPage=1; renderDetail(target); filterBadge.style.display=filteredDetail.length?'':'none'; return; }
    const keys=field?[field]:['ì‹œë„ëª…','ì‹œêµ°êµ¬','ìë©´ë™','ìœ í˜•','ë‹¨ì§€ì½”ë“œ','ë‹¨ì§€ëª…','ì‚¬ìš©ìŠ¹ì¸ì¼','ì´ì„¸ëŒ€ìˆ˜','ì „ìš©ë©´ì ','êµ¬ì¡°', 'ë°©ìˆ˜', 'ìš•ì‹¤ìˆ˜', 'í‰í˜•ëª…', 'í‰í˜•ë³„ ì„¸ëŒ€ìˆ˜'];
    const out=target.filter(r=>keys.some(k=>String(r[k]??'').toLowerCase().includes(q)));
    currentPage=1; renderDetail(out);
    filterBadge.textContent=`ê²€ìƒ‰ ê²°ê³¼: ${fmt(out.length)}í–‰`; filterBadge.style.display='';
  }


// ìƒì„¸ rows ì•ˆì— ì‹œêµ°êµ¬ê°€ 1ì¢…ë¥˜ë¿ì´ë©´ ê·¸ ì´ë¦„ì„ ë°˜í™˜
function deriveSggName(rows){
  const set = new Set();
  for(const r of rows){
    const sgg = String(r['ì‹œêµ°êµ¬'] || '').trim();
    if(sgg) set.add(sgg);
    if(set.size > 1) break; // ë‘ ê°€ì§€ ì´ìƒì´ë©´ ì¤‘ë‹¨
  }
  return set.size === 1 ? Array.from(set)[0] : '';
}

  function downloadExcel(){
  const rows = (filteredDetail.length ? filteredDetail : apartments);
  if(!rows.length){ alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

  // â–¼ íŒŒì¼ëª… ê²°ì •: 1) ì„ íƒëœ ì‹œêµ°êµ¬ 2) ìƒì„¸ rowsê°€ ë‹¨ì¼ ì‹œêµ°êµ¬ë©´ ê·¸ ì´ë¦„ 3) ê¸°ë³¸ê°’
  let sggName = (selectedSgg || '').trim();
  if(!sggName){
    sggName = deriveSggName(rows);
  }
  const filename = sggName ? `${sggName}.xlsx` : 'apartments_all.xlsx';

  const headers=['ì‹œë„ëª…','ì‹œêµ°êµ¬','ìë©´ë™','ìœ í˜•','ë‹¨ì§€ì½”ë“œ','ë‹¨ì§€ëª…','ì‚¬ìš©ìŠ¹ì¸ì¼','ì´ì„¸ëŒ€ìˆ˜','ì „ìš©ë©´ì ', 'êµ¬ì¡°', 'ë°©ìˆ˜', 'ìš•ì‹¤ìˆ˜', 'í‰í˜•ëª…', 'í‰í˜•ë³„ ì„¸ëŒ€ìˆ˜'];
  const ws = XLSX.utils.json_to_sheet(rows, { header: headers });
  headers.forEach((h,i)=>{ const c = XLSX.utils.encode_col(i)+'1'; if(ws[c]) ws[c].v = h; });

  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'ì•„íŒŒíŠ¸ë‹¨ì§€');
  XLSX.writeFile(wb, filename);
}


  // Events
  leftSearch.addEventListener('input', ()=>{ computeSggCounts(); renderLeft(); });
  [ckSale,minUnitsInp,areaFromInp,areaToInp].forEach(el=>{
    el.addEventListener('input', ()=>{ computeSggCounts(); renderLeft(); applyDetailFilter(); });
  });
  // ë³µêµ¬ëœ 200/300 ë¹ ë¥¸ì…ë ¥ ë²„íŠ¼ ë™ì‘
  document.querySelectorAll('.unit-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      minUnitsInp.value = btn.dataset.val;
      computeSggCounts(); renderLeft(); applyDetailFilter();
    });
  });
  sortByCountTh.addEventListener('click', ()=>{
    if(sortDir===null) sortDir='asc'; else if(sortDir==='asc') sortDir='desc'; else sortDir=null;
    computeSggCounts(); renderLeft();
  });
  prevBtn.addEventListener('click', ()=>{ if(currentPage>1){ currentPage--; renderDetail(filteredDetail.length?filteredDetail:apartments); }});
  nextBtn.addEventListener('click', ()=>{ currentPage++; renderDetail(filteredDetail.length?filteredDetail:apartments); });
  // í˜ì´ì§€ í¬ê¸° ì„ íƒ
  pageSizeSel.addEventListener('change', ()=>{
    pageSize = parseInt(pageSizeSel.value, 10);
    currentPage = 1;
    renderDetail(filteredDetail.length ? filteredDetail : apartments);
  });
  detailSearch.addEventListener('input', doDetailSearch);
  colSelect.addEventListener('change', doDetailSearch);
  downloadBtn.addEventListener('click', downloadExcel);

  async function init(){
    const res=await fetch('apartments.json');
    apartments=await res.json();
    apartments=apartments.map(r=>{
      const u=toNum(r['ì´ì„¸ëŒ€ìˆ˜']); if(Number.isFinite(u)) r['ì´ì„¸ëŒ€ìˆ˜']=u;
      const a=toNum(r['ì „ìš©ë©´ì ']); if(Number.isFinite(a)) r['ì „ìš©ë©´ì ']=a;
      return r;
    });
    buildComplexes(apartments);
    computeSggCounts(); renderLeft();
    applyDetailFilter();
    const sggSet=new Set(complexes.map(c=>(c.ì‹œë„ëª…||'')+'|'+(c.ì‹œêµ°êµ¬||'')));
    summaryMeta.textContent=`ì‹œêµ°êµ¬ ${fmt(sggSet.size)}ê°œ Â· ë‹¨ì§€ ${fmt(complexes.length)}ê°œ`;
  }
  window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
