<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Sellporter Launcher</title>
  <style>
    body { font:14px/1.6 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding:24px; }
    #fallback { margin-top:12px; display:none; }
    a.button { display:inline-block; padding:8px 12px; border:1px solid #ccc; border-radius:8px; text-decoration:none; }
  </style>
  <script>
    (function () {
      function qs(name) {
        var p = new URLSearchParams(location.search);
        return p.get(name) || "";
      }
      var target = qs("u");
      function showFallback() {
        var fb = document.getElementById("fallback");
        var link = document.getElementById("fallbackLink");
        link.href = target || "#";
        fb.style.display = "block";
      }

      if (!target) {
        document.addEventListener("DOMContentLoaded", function(){
          document.body.textContent = "대상 주소(u)가 없습니다.";
        });
        return;
      }

      // 1) 먼저 같은 이름의 창/탭을 확보 (빈 about:blank라도 열거나 재사용)
      //    - 이 단계가 사용자 제스처 직후라 팝업차단에 가장 관대
      var w = null;
      try { w = window.open("", "SELLPORTER_TAB"); } catch (e) { w = null; }

      if (!w) {
        // 2a) 확보 실패 → 현재 탭에서 바로 이동(확실)
        location.replace(target);
        return;
      }

      try {
        // 2b) 확보 성공 → 확보한 창을 대상 URL로 전환
        // 일부 브라우저는 즉시 닫으면 탐색이 취소될 수 있으므로 약간 지연 후 닫기
        w.location.href = target;
        if (w.focus) w.focus();

        // 3) 전환 안정화를 위해 약간 지연 후 자기 자신 닫기
        setTimeout(function(){ window.close(); }, 150);

        // 4) 그래도 실패하는 환경 대비 타임아웃으로 폴백 표시
        setTimeout(function(){
          // 새 탭이 실제 열렸는지 확신할 수 없으므로 수동 링크 제공
          showFallback();
        }, 1200);
      } catch (e) {
        // 예외 시 현재 탭에서 이동
        location.replace(target);
      }
    })();
  </script>
</head>
<body>
  열리는 중입니다…
  <div id="fallback">
    자동으로 열리지 않으면 아래 버튼을 눌러주세요.<br>
    <a id="fallbackLink" class="button" target="SELLPORTER_TAB" rel="noopener">열기</a>
  </div>
</body>
</html>
