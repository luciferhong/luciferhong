<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>카카오맵 텍스트 마커 예제</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=351c989af9f6732828f8e7579d7f57bf"></script>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        #mapContainer {
            flex: 1 1 auto; /* 지도 영역이 가능한 모든 공간을 차지하도록 설정 */
        }
        #map {
            width: 100%;
            height: 100%;
        }
        #controlsContainer {
            height: 30vh; /* 화면 높이의 30% */
            overflow-y: auto; /* 내용이 넘칠 경우 스크롤 활성화 */
            padding: 10px;
            box-sizing: border-box;
            background-color: #f9f9f9;
        }
        .text-select {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            padding-bottom: 10px;
        }
        .text-option1 {
            padding: 3px;
            border: 2px solid transparent;
            border-radius: 5px;
            background-color: #156082; /* 배경색 설정 */
            color: white; /* 글자색 설정 */
            cursor: pointer;
            font-size: 12px;
            width: 80px; /* 텍스트 박스의 너비 */
        }
        .text-option2 {
            padding: 3px;
            border: 2px solid transparent;
            border-radius: 5px;
            background-color: #D87508; /* 배경색 설정 */
            color: white; /* 글자색 설정 */
            cursor: pointer;
            font-size: 12px;
            width: 80px; /* 텍스트 박스의 너비 */
        }
        .text-option1.selected {
            border-color: blue;
            background-color: #0e4356; /* 선택된 상태의 배경색 */
        }
        #locationButton {
            width: 100%; /* 버튼 크기 */
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            background-color: #007BFF;
            color: white;
            text-align: center;
            border-radius: 5px;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div id="mapContainer">
        <div id="map"></div>
    </div>
    <div id="controlsContainer">
        <div class="text-select">
            <input type="text" class="text-option1" id="text1" value="상가">
            <input type="text" class="text-option1" id="text2" value="학원">
            <input type="text" class="text-option1" id="text3" value="쪽문">
            <input type="text" class="text-option1" id="text4" value="학교">
            <input type="text" class="text-option2" id="text5" value="언덕">
            <input type="text" class="text-option2" id="text6" value="단차">
            <input type="text" class="text-option2" id="text7" value="엘베">
            <input type="text" class="text-option2" id="text8" value="내리막">
            <input type="text" class="text-option2" id="text9" value="임대">
            <input type="text" class="text-option2" id="text10" value="비선호">
            <input type="text" class="text-option2" id="text11" value="로얄">
            <input type="text" class="text-option2" id="text12" value="커뮤니티">
            <input type="text" class="text-option2" id="text13" value="이중주차">
            <input type="text" class="text-option2" id="text14" value="넓음">
            <input type="text" class="text-option2" id="text15" value="좁음">
            <input type="text" class="text-option2" id="text16" value="답답">
            <input type="text" class="text-option2" id="text17" value="뻥뷰">
            <input type="text" class="text-option2" id="text18" value="막힌뷰">
        </div>
        <button id="locationButton">현재 위치로 이동</button>
    </div>
    <script>
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = { 
                center: new kakao.maps.LatLng(37.5665, 126.9780), // 지도의 초기 중심좌표
                level: 4 // 지도의 확대 레벨 (모바일에 맞게 확대)
            };

        // 지도를 생성합니다    
        var map = new kakao.maps.Map(mapContainer, mapOption); 

        // 마커들을 저장할 배열
        var markers = [];

        // 선택된 텍스트를 저장할 변수
        var selectedText = '';
        var selectedInput = null;

        // 모든 텍스트 입력 요소를 가져옵니다
        var textOptions = document.querySelectorAll('.text-option1');

        // 텍스트 입력 필드를 클릭하여 선택 이벤트를 설정합니다
        textOptions.forEach(function(option) {
            option.addEventListener('click', function() {
                // 모든 요소에서 선택된 클래스 제거
                textOptions.forEach(function(el) {
                    el.classList.remove('selected');
                });
                // 클릭한 요소에 선택된 클래스 추가
                this.classList.add('selected');
                // 선택된 텍스트와 요소 업데이트
                selectedText = this.value;
                selectedInput = this;
            });

            // 텍스트 입력 필드가 수정될 때 선택된 텍스트 업데이트
            option.addEventListener('input', function() {
                if (selectedInput === this) {
                    selectedText = this.value;
                }
            });
        });

        // 현재 위치로 지도를 이동하는 함수
        function moveToCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var lat = position.coords.latitude, // 위도
                        lon = position.coords.longitude; // 경도
                    
                    var locPosition = new kakao.maps.LatLng(lat, lon);
                    map.setCenter(locPosition); // 지도의 중심을 현재 위치로 이동
                }, function(error) {
                    console.error('Geolocation error:', error);
                    alert('현재 위치를 가져올 수 없습니다.');
                });
            } else {
                alert('이 브라우저에서는 Geolocation을 지원하지 않습니다.');
            }
        }

        // 현재 위치 버튼 클릭 이벤트 설정
        document.getElementById('locationButton').addEventListener('click', moveToCurrentLocation);

        // 지도를 클릭한 위치에 선택된 텍스트를 추가합니다
        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {        
            // 텍스트가 선택되지 않은 경우 경고 메시지 표시
            if (!selectedText) {
                alert("텍스트를 선택하세요.");
                return;
            }

            // 클릭한 위도, 경도 정보를 가져옵니다 
            var latlng = mouseEvent.latLng;

            // 사용자가 선택한 텍스트의 배경색과 글자색 가져오기
            var bgColor = selectedInput.style.backgroundColor || '#156082';
            var textColor = selectedInput.style.color || 'white';

            // 커스텀 오버레이를 생성하여 텍스트를 표시합니다 (선택된 텍스트 스타일 적용)
            var content = '<div style="padding:5px; background-color:' + bgColor + '; color:' + textColor + '; border:1px solid black; border-radius:3px;">' + selectedText + '</div>';
            var customOverlay = new kakao.maps.CustomOverlay({
                position: latlng,
                content: content,
                yAnchor: 1 // 텍스트가 클릭한 위치의 하단에 오도록 설정
            });

            // 커스텀 오버레이를 지도에 표시합니다
            customOverlay.setMap(map);

            // 생성한 커스텀 오버레이를 배열에 저장합니다
            markers.push(customOverlay);

            // 오버레이를 클릭하면 삭제되도록 이벤트를 추가합니다
            kakao.maps.event.addListener(customOverlay, 'click', function() {
                customOverlay.setMap(null); // 오버레이를 지도에서 제거
                markers = markers.filter(function(m) { return m !== customOverlay; }); // 배열에서도 제거
            });
        });
    </script>
</body>
</html>
