<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>카카오맵 선택 마커 예제</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=351c989af9f6732828f8e7579d7f57bf"></script>
    <style>
        #map {width: 100%; height: 400px;}
        .marker-select {display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;}
        .marker-option {
            cursor: pointer; 
            border: 2px solid transparent;
            width: 70.7px; /* 이미지 가로 크기 */
            height: 34.4px; /* 이미지 세로 크기 */
        }
        .marker-option.selected {border-color: blue;}
        #locationButton {margin: 10px 0; padding: 5px 10px; cursor: pointer;}
    </style>
</head>
<body>
    <div id="map"></div>
    <button id="locationButton">현재 위치로 이동</button>
    <div class="marker-select">
        <img src="./store.png" class="marker-option" id="marker1" alt="Marker 1">
        <img src="./eli.png" class="marker-option" id="marker2" alt="Marker 2">
        <img src="./minidoor.png" class="marker-option" id="marker3" alt="Marker 3">
        <img src="./wide.png" class="marker-option" id="marker4" alt="Marker 4">
        <img src="./narrow.png" class="marker-option" id="marker5" alt="Marker 5">
        <img src="./parkinghell.png" class="marker-option" id="marker6" alt="Marker 6">
        <img src="./dc.png" class="marker-option" id="marker7" alt="Marker 7">
        <img src="./hill.png" class="marker-option" id="marker8" alt="Marker 8">
        <img src="./down.png" class="marker-option" id="marker9" alt="Marker 9">
    </div>
    <script>
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = { 
                center: new kakao.maps.LatLng(37.5665, 126.9780), // 지도의 초기 중심좌표
                level: 3 // 지도의 확대 레벨
            };

        // 지도를 생성합니다    
        var map = new kakao.maps.Map(mapContainer, mapOption); 

        // 선택된 마커 이미지 경로를 저장할 변수
        var selectedMarkerImage = './store.png'; // 기본값 설정

        // 마커들을 저장할 배열
        var markers = [];

        // 모든 마커 선택 요소를 가져옵니다
        var markerOptions = document.querySelectorAll('.marker-option');

        // 마커 선택 이벤트를 설정합니다
        markerOptions.forEach(function(option) {
            option.addEventListener('click', function() {
                // 모든 요소에서 선택된 클래스 제거
                markerOptions.forEach(function(el) {
                    el.classList.remove('selected');
                });
                // 클릭한 요소에 선택된 클래스 추가
                this.classList.add('selected');
                // 선택된 마커 이미지 경로 업데이트
                selectedMarkerImage = this.src;
            });
        });

        // 현재 위치로 지도를 이동하는 함수
        function moveToCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var lat = position.coords.latitude, // 위도
                        lon = position.coords.longitude; // 경도
                    
                    var locPosition = new kakao.maps.LatLng(lat, lon);
                    map.setCenter(locPosition); // 지도의 중심을 현재 위치로 이동

                    // 현재 위치에 마커를 추가할 수도 있습니다 (선택 사항)
                    /*
                    var marker = new kakao.maps.Marker({
                        position: locPosition
                    });
                    marker.setMap(map);
                    */
                }, function(error) {
                    console.error('Geolocation error:', error);
                    alert('현재 위치를 가져올 수 없습니다.');
                });
            } else {
                alert('이 브라우저에서는 Geolocation을 지원하지 않습니다.');
            }
        }

        // 현재 위치 버튼 클릭 이벤트 설정
        document.getElementById('locationButton').addEventListener('click', moveToCurrentLocation);

        // 지도를 클릭한 위치에 선택된 마커를 추가합니다
        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {        
            // 클릭한 위도, 경도 정보를 가져옵니다 
            var latlng = mouseEvent.latLng; 

            // 선택된 마커 이미지를 생성합니다 (크기를 70.7x34.4로 고정)
            var markerImage = new kakao.maps.MarkerImage(
                selectedMarkerImage, // 선택된 이미지 경로
                new kakao.maps.Size(70.7, 34.4), // 이미지 크기 고정
                {offset: new kakao.maps.Point(35.35, 17.2)} // 마커 좌표에 대한 이미지의 기준점 설정 (중앙 하단)
            );

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                position: latlng, // 마커의 위치
                image: markerImage // 마커 이미지 설정
            });

            // 마커를 지도에 표시합니다
            marker.setMap(map);

            // 생성한 마커를 배열에 저장합니다
            markers.push(marker);

            // 마커에 클릭 이벤트를 추가하여 삭제 기능을 구현합니다
            kakao.maps.event.addListener(marker, 'click', function() {
                marker.setMap(null); // 마커를 지도에서 제거
                markers = markers.filter(function(m) { return m !== marker; }); // 배열에서도 제거
            });
        });
    </script>
</body>
</html>
