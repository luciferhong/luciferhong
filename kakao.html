<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>카카오맵 선택 마커 예제</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=351c989af9f6732828f8e7579d7f57bf"></script>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        #mapContainer {
            flex: 1 1 auto; /* 지도 영역이 가능한 모든 공간을 차지하도록 설정 */
        }
        #map {
            width: 100%;
            height: 100%;
        }
        #controlsContainer {
            height: 30vh; /* 화면 높이의 30% */
            overflow-y: auto; /* 내용이 넘칠 경우 스크롤 활성화 */
            padding: 10px;
            box-sizing: border-box;
            background-color: #f9f9f9;
        }
        .marker-select {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            padding-bottom: 10px;
        }
        .marker-option {
            cursor: pointer; 
            border: 2px solid transparent;
            width: 70px; /* 이미지 가로 크기 */
            height: 34px; /* 이미지 세로 크기 */
        }
        .marker-option.selected {border-color: blue;}
        #locationButton {
            width: 100%; /* 버튼 크기 */
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            background-color: #007BFF;
            color: white;
            text-align: center;
            border-radius: 5px;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div id="mapContainer">
        <div id="map"></div>
    </div>
    <div id="controlsContainer">
        <div class="marker-select">
            <img src="./store.png?v=1" class="marker-option" id="marker1" alt="Marker 1">
            <img src="./eli.png?v=1" class="marker-option" id="marker2" alt="Marker 2">
            <img src="./minidoor.png?v=1" class="marker-option" id="marker3" alt="Marker 3">
            <img src="./wide.png?v=1" class="marker-option" id="marker4" alt="Marker 4">
            <img src="./narrow.png?v=1" class="marker-option" id="marker5" alt="Marker 5">
            <img src="./parkinghell.png?v=1" class="marker-option" id="marker6" alt="Marker 6">
            <img src="./dc.png?v=1" class="marker-option" id="marker7" alt="Marker 7">
            <img src="./hill.png?v=1" class="marker-option" id="marker8" alt="Marker 8">
            <img src="./down.png?v=1" class="marker-option" id="marker9" alt="Marker 9">
        </div>
        <button id="locationButton">현재 위치로 이동</button>
    </div>
    <script>
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = { 
                center: new kakao.maps.LatLng(37.5665, 126.9780), // 지도의 초기 중심좌표
                level: 4 // 지도의 확대 레벨 (모바일에 맞게 확대)
            };

        // 지도를 생성합니다    
        var map = new kakao.maps.Map(mapContainer, mapOption); 

        // 선택된 마커 이미지 경로를 저장할 변수
        var selectedMarkerImage = './store.png?v=1'; // 기본값 설정

        // 마커들을 저장할 배열
        var markers = [];

        // 모든 마커 선택 요소를 가져옵니다
        var markerOptions = document.querySelectorAll('.marker-option');

        // 마커 선택 이벤트를 설정합니다
        markerOptions.forEach(function(option) {
            option.addEventListener('click', function() {
                // 모든 요소에서 선택된 클래스 제거
                markerOptions.forEach(function(el) {
                    el.classList.remove('selected');
                });
                // 클릭한 요소에 선택된 클래스 추가
                this.classList.add('selected');
                // 선택된 마커 이미지 경로 업데이트
                selectedMarkerImage = this.src;
            });
        });

        // 현재 위치로 지도를 이동하는 함수
        function moveToCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var lat = position.coords.latitude, // 위도
                        lon = position.coords.longitude; // 경도
                    
                    var locPosition = new kakao.maps.LatLng(lat, lon);
                    map.setCenter(locPosition); // 지도의 중심을 현재 위치로 이동
                }, function(error) {
                    console.error('Geolocation error:', error);
                    alert('현재 위치를 가져올 수 없습니다.');
                });
            } else {
                alert('이 브라우저에서는 Geolocation을 지원하지 않습니다.');
            }
        }

        // 현재 위치 버튼 클릭 이벤트 설정
        document.getElementById('locationButton').addEventListener('click', moveToCurrentLocation);

        // 지도를 클릭한 위치에 선택된 마커를 추가합니다
        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {        
            // 클릭한 위도, 경도 정보를 가져옵니다 
            var latlng = mouseEvent.latLng; 

            // 선택된 마커 이미지를 생성합니다 (크기를 이미지 크기에 맞게 설정)
            var markerImage = new kakao.maps.MarkerImage(
                selectedMarkerImage, // 선택된 이미지 경로
                new kakao.maps.Size(70, 34), // 이미지 크기 설정 (원하는 크기)
                {offset: new kakao.maps.Point(35, 17)} // 마커 좌표에 대한 이미지의 기준점 설정 (중앙 하단)
            );

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                position: latlng, // 마커의 위치
                image: markerImage // 마커 이미지 설정
            });

            // 마커를 지도에 표시합니다
            marker.setMap(map);

            // 생성한 마커를 배열에 저장합니다
            markers.push(marker);

            // 마커에 클릭 이벤트를 추가하여 삭제 기능을 구현합니다
            kakao.maps.event.addListener(marker, 'click', function() {
                marker.setMap(null); // 마커를 지도에서 제거
                markers = markers.filter(function(m) { return m !== marker; }); // 배열에서도 제거
            });
        });
    </script>
</body>
</html>
